<!-- frontend/test-completo.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Prueba Completa Sistema</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }
        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; background: #e8f5e9; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .error { color: red; background: #ffebee; padding: 10px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; background: #3ecf8e; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2ebd7e; }
        input, select { padding: 8px; margin: 5px; width: 200px; }
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
    <!-- Cargar Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <h1>üíà Sistema de Turnos - Prueba Completa</h1>
        
        <!-- Secci√≥n 1: Conexi√≥n -->
        <div class="section">
            <h2>1. Conexi√≥n a Supabase</h2>
            <div id="connection-status">No probado</div>
            <button onclick="testConnection()">Probar Conexi√≥n</button>
        </div>
        
        <!-- Secci√≥n 2: Servicios -->
        <div class="section">
            <h2>2. Servicios Disponibles</h2>
            <div id="servicios-list">Cargando...</div>
            <button onclick="loadServicios()">Cargar Servicios</button>
        </div>
        
        <!-- Secci√≥n 3: Registro/Login -->
        <div class="section">
            <h2>3. Autenticaci√≥n</h2>
            <div>
                <h3>Registro</h3>
                <input type="text" id="reg-nombre" placeholder="Nombre">
                <input type="email" id="reg-email" placeholder="Email">
                <input type="password" id="reg-password" placeholder="Contrase√±a">
                <input type="tel" id="reg-telefono" placeholder="Tel√©fono">
                <button onclick="registrarUsuario()">Registrarse</button>
            </div>
            <div style="margin-top: 20px;">
                <h3>Login</h3>
                <input type="email" id="login-email" placeholder="Email">
                <input type="password" id="login-password" placeholder="Contrase√±a">
                <button onclick="iniciarSesion()">Iniciar Sesi√≥n</button>
            </div>
            <div id="auth-status"></div>
        </div>
        
        <!-- Secci√≥n 4: Usuario Actual -->
        <div class="section">
            <h2>4. Usuario Actual</h2>
            <div id="user-info">No autenticado</div>
            <button onclick="getCurrentUserInfo()">Obtener Usuario</button>
            <button onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
        </div>
        
        <!-- Secci√≥n 5: Crear Turno -->
        <div class="section">
            <h2>5. Crear Turno de Prueba</h2>
            <div id="turno-status"></div>
            <button onclick="crearTurnoPrueba()">Crear Turno de Prueba</button>
            <button onclick="verTurnos()">Ver Mis Turnos</button>
        </div>
    </div>
    
    <!-- Nuestro JavaScript -->
    <script type="module">
        import { 
          initSupabase, testConnection, getServicios, 
          signUp, signIn, signOut, getCurrentUser,
          createTurno, getTurnosCliente 
        } from './js/supabase-client.js';
        
        // Inicializar al cargar
        document.addEventListener('DOMContentLoaded', function() {
            initSupabase();
            loadServicios();
        });
        
        // 1. Probar conexi√≥n
        window.testConnection = async function() {
            const status = document.getElementById('connection-status');
            status.innerHTML = 'Probando...';
            
            const result = await testConnection();
            
            if (result.success) {
                status.innerHTML = `<div class="success">‚úÖ ${result.message}</div>`;
            } else {
                status.innerHTML = `<div class="error">‚ùå ${result.error}</div>`;
            }
        };
        
        // 2. Cargar servicios
        window.loadServicios = async function() {
            const list = document.getElementById('servicios-list');
            list.innerHTML = 'Cargando...';
            
            const { data, error } = await getServicios();
            
            if (error) {
                list.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                return;
            }
            
            if (data.length === 0) {
                list.innerHTML = '<p>No hay servicios. Ejecuta el SQL en Supabase.</p>';
                return;
            }
            
            list.innerHTML = data.map(servicio => `
                <div class="card">
                    <h3>${servicio.nombre}</h3>
                    <p>${servicio.descripcion || 'Sin descripci√≥n'}</p>
                    <p>üí∞ $${servicio.precio} | ‚è±Ô∏è ${servicio.duracion_min} min</p>
                </div>
            `).join('');
        };
        
        // 3. Registrar usuario
        window.registrarUsuario = async function() {
            const nombre = document.getElementById('reg-nombre').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const telefono = document.getElementById('reg-telefono').value;
            
            const status = document.getElementById('auth-status');
            status.innerHTML = 'Registrando...';
            
            const result = await signUp(email, password, nombre, telefono);
            
            if (result.success) {
                status.innerHTML = `<div class="success">‚úÖ ${result.message}</div>`;
                getCurrentUserInfo();
            } else {
                status.innerHTML = `<div class="error">‚ùå ${result.error}</div>`;
            }
        };
        
        // 4. Iniciar sesi√≥n
        window.iniciarSesion = async function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const status = document.getElementById('auth-status');
            status.innerHTML = 'Iniciando sesi√≥n...';
            
            const result = await signIn(email, password);
            
            if (result.success) {
                status.innerHTML = `<div class="success">‚úÖ Sesi√≥n iniciada</div>`;
                getCurrentUserInfo();
            } else {
                status.innerHTML = `<div class="error">‚ùå ${result.error}</div>`;
            }
        };
        
        // 5. Obtener usuario actual
        window.getCurrentUserInfo = async function() {
            const info = document.getElementById('user-info');
            const { user, error } = await getCurrentUser();
            
            if (error || !user) {
                info.innerHTML = '<div class="error">No autenticado</div>';
                return;
            }
            
            info.innerHTML = `
                <div class="success">
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>ID:</strong> ${user.id.substring(0, 8)}...</p>
                    <p><strong>Autenticado:</strong> S√≠</p>
                </div>
            `;
        };
        
        // 6. Cerrar sesi√≥n
        window.cerrarSesion = async function() {
            const { error } = await signOut();
            
            if (error) {
                alert('Error: ' + error.message);
            } else {
                document.getElementById('user-info').innerHTML = '<div class="success">‚úÖ Sesi√≥n cerrada</div>';
                document.getElementById('auth-status').innerHTML = '';
            }
        };
        
        // 7. Crear turno de prueba
        window.crearTurnoPrueba = async function() {
            const status = document.getElementById('turno-status');
            const { user } = await getCurrentUser();
            
            if (!user) {
                status.innerHTML = '<div class="error">Debes iniciar sesi√≥n primero</div>';
                return;
            }
            
            // Datos de ejemplo (necesitar√≠as tener barberos y servicios creados)
            const turnoData = {
                cliente_id: user.id,
                barbero_id: '00000000-0000-0000-0000-000000000000', // Ejemplo
                servicio_id: '00000000-0000-0000-0000-000000000000', // Ejemplo
                fecha: '2024-01-15',
                hora: '10:00',
                estado: 'pendiente',
                notas: 'Turno de prueba'
            };
            
            status.innerHTML = 'Creando turno...';
            
            const { data, error } = await createTurno(turnoData);
            
            if (error) {
                status.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            } else {
                status.innerHTML = `<div class="success">‚úÖ Turno creado (ID: ${data[0].id.substring(0, 8)}...)</div>`;
            }
        };
        
        // 8. Ver turnos
        window.verTurnos = async function() {
            const status = document.getElementById('turno-status');
            const { data, error } = await getTurnosCliente();
            
            if (error) {
                status.innerHTML = `<div class="error">‚ùå ${error}</div>`;
                return;
            }
            
            if (!data || data.length === 0) {
                status.innerHTML = '<p>No tienes turnos</p>';
                return;
            }
            
            status.innerHTML = `
                <h3>Tus Turnos (${data.length})</h3>
                ${data.map(turno => `
                    <div class="card">
                        <p><strong>Fecha:</strong> ${turno.fecha} ${turno.hora}</p>
                        <p><strong>Estado:</strong> ${turno.estado}</p>
                        <p><strong>Servicio:</strong> ${turno.servicios?.nombre || 'N/A'}</p>
                    </div>
                `).join('')}
            `;
        };
    </script>
</body>
</html>