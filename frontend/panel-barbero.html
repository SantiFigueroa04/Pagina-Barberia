<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Barberos - Barbería Elite</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/panel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <!-- Botón toggle para móvil -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="user-avatar" id="barbero-avatar">
                <i class="fas fa-user-tie"></i>
            </div>
            <h2 id="barbero-nombre">Cargando...</h2>
            <p id="barbero-rol">Barbero</p>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="#turnos" data-section="turnos">
                <i class="fas fa-calendar-alt"></i> Mis Turnos
            </a>
            <a href="#calendario" data-section="calendario">
                <i class="fas fa-calendar-day"></i> Calendario
            </a>
            <a href="#horarios" data-section="horarios">
                <i class="fas fa-clock"></i> Mis Horarios
            </a>
            <a href="#estadisticas" data-section="estadisticas">
                <i class="fas fa-chart-bar"></i> Estadísticas
            </a>
            <a href="#perfil" data-section="perfil">
                <i class="fas fa-user-cog"></i> Mi Perfil
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn btn-secondary btn-block" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </button>
            <p style="margin-top: 15px; font-size: 0.8rem; color: #888;">
                <i class="fas fa-info-circle"></i> Panel Barberos v1.0
            </p>
        </div>
    </aside>

    <!-- Contenido Principal -->
    <main class="main-content" id="mainContent">
        <!-- Header del Panel -->
        <header class="panel-header">
            <div class="user-info">
                <div class="user-avatar" id="header-avatar">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div>
                    <h3 id="header-nombre">Barbero</h3>
                    <p id="header-email" style="color: #666; font-size: 0.9rem;">cargando...</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="date-picker" style="display: inline-block;">
                    <input type="text" id="datePicker" placeholder="Seleccionar fecha" 
                           style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <button class="btn btn-primary" id="todayBtn">
                    <i class="fas fa-calendar-day"></i> Hoy
                </button>
            </div>
        </header>

        <!-- Contenido Dinámico -->
        <div id="contentSections">
            <!-- Dashboard (Inicio) -->
            <section id="dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number" id="turnos-hoy">0</div>
                        <div class="stat-label">Turnos Hoy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-number" id="turnos-pendientes">0</div>
                        <div class="stat-label">Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-number" id="ingresos-mes">$0</div>
                        <div class="stat-label">Ingresos Mes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-number" id="calificacion">0.0</div>
                        <div class="stat-label">Calificación</div>
                    </div>
                </div>

                <!-- Próximos turnos -->
                <div class="turnos-container">
                    <div class="turnos-header">
                        <h3><i class="fas fa-calendar-alt"></i> Próximos Turnos</h3>
                        <button class="btn btn-primary" id="refreshTurnos">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="turnos-table" id="proximos-turnos">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Servicio</th>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Cargado por JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Calendario mini -->
                <div class="calendario-barbero">
                    <h3><i class="fas fa-calendar-day"></i> Calendario</h3>
                    <div id="mini-calendar" style="margin-top: 20px;">
                        <!-- Calendario simple -->
                    </div>
                </div>
            </section>

            <!-- Mis Turnos -->
            <section id="turnos" class="content-section">
                <div class="turnos-container">
                    <div class="turnos-header">
                        <h3><i class="fas fa-list"></i> Todos mis Turnos</h3>
                        <div class="header-actions">
                            <select id="filterEstado" class="form-control" style="width: 150px;">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendientes</option>
                                <option value="confirmado">Confirmados</option>
                                <option value="completado">Completados</option>
                                <option value="cancelado">Cancelados</option>
                            </select>
                            <input type="date" id="filterFecha" class="form-control" style="width: 150px;">
                            <button class="btn btn-primary" id="filterBtn">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="turnos-table" id="todos-turnos">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Teléfono</th>
                                    <th>Servicio</th>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Cargado por JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Calendario Completo -->
            <section id="calendario" class="content-section">
                <div class="calendario-barbero">
                    <div class="turnos-header">
                        <h3><i class="fas fa-calendar"></i> Calendario Completo</h3>
                        <div class="header-actions">
                            <button class="btn btn-secondary" id="prevMonth">
                                <i class="fas fa-chevron-left"></i> Mes Anterior
                            </button>
                            <h4 id="currentMonth" style="margin: 0 20px;">Mes Actual</h4>
                            <button class="btn btn-secondary" id="nextMonth">
                                Mes Siguiente <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div id="full-calendar" style="margin-top: 30px;">
                        <!-- Calendario completo -->
                    </div>
                </div>
            </section>

            <!-- Mis Horarios -->
            <section id="horarios" class="content-section">
                <div class="turnos-container">
                    <div class="turnos-header">
                        <h3><i class="fas fa-clock"></i> Mis Horarios Disponibles</h3>
                        <button class="btn btn-primary" id="addHorarioBtn">
                            <i class="fas fa-plus"></i> Agregar Horarios
                        </button>
                    </div>
                    
                    <!-- Formulario para agregar horarios -->
                    <div id="horario-form" class="filtros-container" style="display: none;">
                        <h4>Agregar Nuevos Horarios</h4>
                        <div class="filtros-grid">
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="newHorarioFecha" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Hora Inicio</label>
                                <input type="time" id="newHorarioInicio" class="form-control" value="09:00">
                            </div>
                            <div class="form-group">
                                <label>Hora Fin</label>
                                <input type="time" id="newHorarioFin" class="form-control" value="18:00">
                            </div>
                            <div class="form-group">
                                <label>Intervalo (minutos)</label>
                                <select id="newHorarioIntervalo" class="form-control">
                                    <option value="30">30 minutos</option>
                                    <option value="60">60 minutos</option>
                                    <option value="90">90 minutos</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-success" id="generateHorariosBtn">
                                <i class="fas fa-magic"></i> Generar Horarios
                            </button>
                            <button class="btn btn-secondary" id="cancelHorarioBtn">
                                Cancelar
                            </button>
                        </div>
                    </div>

                    <!-- Lista de horarios -->
                    <div class="table-responsive" style="margin-top: 30px;">
                        <table class="turnos-table" id="horarios-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Disponible</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Cargado por JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Estadísticas -->
            <section id="estadisticas" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-number" id="stats-total-turnos">0</div>
                        <div class="stat-label">Total Turnos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-number" id="stats-ocupacion">0%</div>
                        <div class="stat-label">Ocupación</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number" id="stats-clientes-unicos">0</div>
                        <div class="stat-label">Clientes Únicos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number" id="stats-promedio-duracion">0</div>
                        <div class="stat-label">Promedio (min)</div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="turnos-container">
                    <div class="turnos-header">
                        <h3><i class="fas fa-chart-line"></i> Estadísticas Detalladas</h3>
                        <select id="statsPeriod" class="form-control" style="width: 150px;">
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                            <option value="quarter">Este trimestre</option>
                            <option value="year">Este año</option>
                        </select>
                    </div>
                    <div class="charts-container" style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4>Turnos por Estado</h4>
                                <canvas id="chartEstados" width="400" height="300"></canvas>
                            </div>
                            <div>
                                <h4>Ingresos Mensuales</h4>
                                <canvas id="chartIngresos" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Mi Perfil -->
            <section id="perfil" class="content-section">
                <div class="turnos-container">
                    <div class="turnos-header">
                        <h3><i class="fas fa-user-cog"></i> Mi Perfil</h3>
                        <button class="btn btn-primary" id="saveProfileBtn">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                    </div>

                    <div class="profile-form" style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 40px;">
                            <!-- Foto de perfil -->
                            <div style="text-align: center;">
                                <div id="profile-avatar" style="width: 150px; height: 150px; background: #ddd; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #666;">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <button class="btn btn-secondary" style="margin-top: 10px;">
                                    <i class="fas fa-camera"></i> Cambiar Foto
                                </button>
                            </div>

                            <!-- Información del perfil -->
                            <div>
                                <div class="form-group">
                                    <label>Nombre Completo</label>
                                    <input type="text" id="profileNombre" class="form-control" placeholder="Tu nombre">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="profileEmail" class="form-control" placeholder="tu@email.com" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Teléfono</label>
                                    <input type="tel" id="profileTelefono" class="form-control" placeholder="Tu teléfono">
                                </div>
                                <div class="form-group">
                                    <label>Especialidad</label>
                                    <input type="text" id="profileEspecialidad" class="form-control" placeholder="Ej: Corte clásico, barba, etc.">
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea id="profileDescripcion" class="form-control" rows="4" placeholder="Cuéntanos sobre tu experiencia y estilo..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Cambiar contraseña -->
                        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
                            <h4><i class="fas fa-lock"></i> Cambiar Contraseña</h4>
                            <div class="filtros-grid">
                                <div class="form-group">
                                    <label>Contraseña Actual</label>
                                    <input type="password" id="currentPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Nueva Contraseña</label>
                                    <input type="password" id="newPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Confirmar Nueva Contraseña</label>
                                    <input type="password" id="confirmPassword" class="form-control">
                                </div>
                            </div>
                            <button class="btn btn-warning" id="changePasswordBtn" style="margin-top: 20px;">
                                <i class="fas fa-key"></i> Cambiar Contraseña
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer del panel -->
        <footer class="panel-footer" style="margin-top: 50px; padding: 20px; text-align: center; color: #666; border-top: 1px solid #eee;">
            <p>Panel Barberos v1.0 • Barbería Elite © 2024</p>
            <p id="lastSync" style="font-size: 0.8rem; color: #888;">Última sincronización: --</p>
        </footer>
    </main>

    <!-- Modal para detalles del turno -->
    <div class="modal" id="turnoModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalles del Turno</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Cargado dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/panel-barbero.js" type="module"></script>
</body>
</html>